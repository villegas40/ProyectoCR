@{
    ViewBag.Title = "Inventario";
}
<br />
<h2>Inventario</h2>

<p>
    @Html.ActionLink("Añadir existencias", "Create")
</p>
<input class="form-control mb-1" id="inpBusqueda" onkeyup="paginadoExistencias()" placeholder="Buscar por artículo" />
<div id="printZone" class="margenTopPrint">
<table class="table table-striped">
    <thead>
        <tr>
            <th>Artículo</th>
            <th>Cantidad Actual</th>
            <th class="InvisiblePrint">Opciones</th>
        </tr>
    </thead>
    <tbody id="ctExistencias">
    </tbody>
</table>
</div>
<center>
    <button id="btnPrevious" class="btn btn-default" onclick="paginadoExistencias(parseInt(pageP) - 1)"><i class="fas fa-caret-left"></i></button>
    <label id="previous"></label><label> - <label id="actual"></label> - </label><label id="next"></label>
    <button id="btnNext" class="btn btn-default" onclick="paginadoExistencias(parseInt(pageP) + 1)"><i class="fas fa-caret-right"></i></button>
</center>
<button id="print" onclick="imprimirBusqueda(document.getElementById('printZone'),'Resultados busqueda') " >Imprimir</button>
<script>
    var pageP = 0;
    function paginadoExistencias(page) {
        if (page == undefined) {
            pageP = 1
        } else {
            pageP = page
        }
        var totalpaginas = 0
        var filtro = document.getElementById("inpBusqueda").value
        var frm = new FormData()    
        frm.append("filtro", filtro)
        frm.append("pagina", pageP)
        frm.append("registrosPagina", 15)

        var x = new XMLHttpRequest()
        x.open("POST", "/Existencias/BuscarExistencias")
        x.addEventListener("load", function (e) {
            var response = JSON.parse(x.responseText)
            if (response.length == 0) {
                pageP = 0;
                totalpaginas = 0;
            } else {
                totalpaginas = response[0].total;
            }

            document.getElementById("ctExistencias").innerHTML = ""
            var inner = ""

            for (var i = 0; i < response.length; i++) {
                inner += "<tr><td>" + response[i].item + "</td>" +
                    "<td>" + response[i].cantidad + "</td>" +
                    "<td class=\"InvisiblePrint\"><a class=\"btn btn-info\" href=\"/Existencias/Details/" + response[i].item + "\">Detalles</a></td></tr>"
            }
            document.getElementById("ctExistencias").innerHTML = inner

            document.getElementById("next").textContent = totalpaginas
            if (pageP <= 1) {
                document.getElementById("previous").textContent = pageP
                document.getElementById("btnPrevious").disabled = true
                if (pageP = totalpaginas) {
                    document.getElementById("btnNext").disabled = true
                }
            } else if (pageP == totalpaginas) {
                document.getElementById("btnPrevious").disabled = false
                document.getElementById("btnNext").disabled = true
            } else {
                document.getElementById("btnNext").disabled = false
            }
            document.getElementById("actual").textContent = pageP
        });
        x.send(frm)
    }
    paginadoExistencias()

    function imprimirBusqueda(elem, title) {
        var invisible = document.getElementsByClassName("InvisiblePrint")
        for (var i = 0; i < invisible.length; i++) {
            invisible[i].style.display = "none";
        }

        var margen = document.getElementsByClassName("margenTopPrint")[0].children[0]
        margen.style = 'padding-top:60px;'

        setTimeout(function () {

            var printWindow;
            printWindow = window.open('/Reportes/Index/test1', '', 'height=400,width=800');
            var stringHTML = elem.innerHTML;
            printWindow.document.getElementById('ContenidoImprimir').innerHTML = stringHTML;
            printWindow.document.close();
            printWindow.focus();
            setTimeout(function () {
                printWindow.print();
                printWindow.close();
            }, 750);
        }, 750);
        setTimeout(function () {
            for (var i = 0; i < invisible.length; i++) {
                invisible[i].style.removeProperty("display");
            }
        }, 500);       
    }
</script>
